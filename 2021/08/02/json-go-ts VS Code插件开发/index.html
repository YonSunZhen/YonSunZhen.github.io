<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,ä¸ªäººåšå®¢,blog" />
  <meta name="description" content="å­™æ°¸é•‡ä¸ªäººåšå®¢" />
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/./style/main.4a9772.css">
	<link rel="shortcut icon" href="http://122.51.184.238/storage/api/v1/1_2_åšå®¢/2_7_avatar.jpeg" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>json-go-ts VS Codeæ’ä»¶å¼€å‘</title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?1b5ca8bbd5cf95a2263942c7c20476d9";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/123456.js","daovoice");daovoice('init',{app_id: "123456"});daovoice('update');
  </script>
  
<meta name="generator" content="Hexo 5.4.2"></head>
<body>
<canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/">ç ä¸Šå°±æ¥</a>
  <a class="face-img" href="/">
    <img src="http://122.51.184.238/storage/api/v1/1_2_åšå®¢/2_7_avatar.jpeg">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    json-go-ts VS Codeæ’ä»¶å¼€å‘
  </h1>
  


    <ul class="article-info">
      <li>
        å‘å¸ƒ
        <time datetime="2021-08-02T06:16:10.000Z" itemprop="datePublished">2021-08-02</time>
      </li>
      <li>
        
    æ›´æ–° <time datetime="2023-05-18T14:27:34.597Z" itemprop="dateUpdated">2023-05-18</time>

      </li>
      <li id="busuanzi_container_page_pv">
        é˜…è¯» <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        <h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>é¡¹ç›®ä¸­éœ€è¦ä¸€ä»½jsoné…ç½®æ–‡ä»¶ï¼Œè¿™ä»½é…ç½®æ–‡ä»¶çš„æŸäº›å­—æ®µæ˜¯ä¾æ®å¦å¤–çš„ä¸€ä¸ªtypescripæ–‡ä»¶<code>export</code>å‡ºæ¥çš„å­—æ®µï¼Œä¸ºäº†é™ä½ç¼–ç è¿‡ç¨‹ä¸­é€ æˆçš„å­—æ®µåå‡ºé”™çš„æœºç‡ã€‚</p>
<p>å› æ­¤ï¼Œè€ƒè™‘å¼€å‘ä¸€ä¸ªæ’ä»¶ç”¨äºï¼š</p>
<ul>
<li>jsonæ–‡ä»¶ä¸­è‡ªåŠ¨è¡¥å…¨function name</li>
<li>jaonæ–‡ä»¶åˆ°typescriptæ–‡ä»¶çš„è‡ªå®šä¹‰è·³è½¬</li>
<li>jsonæ–‡ä»¶ä¸­é”™è¯¯æ³¢æµªçº¿æ™ºèƒ½æç¤ºï¼ˆå½“typescriptæ–‡ä»¶æ²¡æœ‰exportè¯¥å­—æ®µæ—¶æ˜¾ç¤ºæ³¢æµªçº¿ï¼‰</li>
</ul>
<p>æ’ä»¶æ•ˆæœï¼š</p>
<p><img src="https://itc.desaysv.com/dfs/wxapp-assets/other/hello.gif" alt="IDE"></p>
<h2 id="å®ç°">å®ç°</h2>
<p>æ€è·¯ï¼šå®šä¹‰ä¸¤ä¸ªæ’ä»¶å˜é‡ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µè‡ªå·±åœ¨æ’ä»¶è®¾ç½®é‡Œé¢é…ç½®ï¼‰</p>
<ul>
<li>fileNameï¼šç”¨äºè¯†åˆ«æ–‡ä»¶åå…³é”®å­— â€“ é»˜è®¤ä¸º<code>index</code></li>
<li>filePathï¼šä»¥jsonæ–‡ä»¶ä¸ºå‚ç…§ï¼Œindex typescriptæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œç”¨äºè·å–tsæ–‡ä»¶ â€“ é»˜è®¤ä¸º<code>./src/index</code></li>
<li>å…³é”®å®ç°ï¼šä½¿ç”¨<code>@babel/parser</code>ã€<code>@babel/traverse</code>å°†tsæ–‡ä»¶è½¬åŒ–ASTï¼Œè¿™æ ·æ‰èƒ½è·å–åˆ°tsæ–‡ä»¶ä¸­exportå‡ºæ¥çš„function name</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/YonSunZhen/vscode-plugin-json-go-ts">é¡¹ç›®æºç </a></p>
<h3 id="è‡ªåŠ¨è¡¥å…¨">è‡ªåŠ¨è¡¥å…¨</h3>
<p>æ€è·¯ï¼š</p>
<ul>
<li>è·å–tsæ–‡ä»¶ä¸­exportå‡ºæ¥çš„functionåˆ—è¡¨</li>
<li>ç›‘å¬VS Codeä¸­å…‰æ ‡å¤„è¾“å…¥çš„å­—ç¬¦ï¼Œå½“è¾“å…¥<code>index.</code>æ—¶ï¼Œå¼¹å‡ºè‡ªåŠ¨è¡¥å…¨é¢æ¿ï¼Œæ­¤æ—¶è‡ªåŠ¨è¡¥å…¨é¢æ¿ä¸­çš„å†…å®¹å°±æ˜¯tsæ–‡ä»¶ä¸­exportå‡ºæ¥çš„æ‰€æœ‰functionåˆ—è¡¨</li>
</ul>
<p>å…³é”®ä»£ç å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>Â <span class="keyword">function</span>Â <span class="title function_">provideCompletionItems</span>(<span class="params"><span class="variable language_">document</span>,Â position,Â token,Â context</span>)Â &#123;</span><br><span class="line">Â Â <span class="keyword">const</span>Â _filePathÂ =Â <span class="title function_">getFilePath</span>(<span class="variable language_">document</span>,Â filePath);</span><br><span class="line">Â Â <span class="keyword">const</span>Â _fnDataÂ =Â <span class="title function_">getFnFromTsFile</span>(<span class="string">`<span class="subst">$&#123;_filePath&#125;</span>.ts`</span>);</span><br><span class="line">Â Â <span class="keyword">const</span>Â linePrefixÂ =Â <span class="variable language_">document</span>.<span class="title function_">lineAt</span>(position).<span class="property">text</span>.<span class="title function_">substr</span>(<span class="number">0</span>,Â position.<span class="property">character</span>);</span><br><span class="line">Â Â <span class="keyword">if</span>Â (!linePrefix.<span class="title function_">endsWith</span>(<span class="string">`&quot;<span class="subst">$&#123;fileName&#125;</span>.`</span>))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â <span class="literal">undefined</span>;</span><br><span class="line">Â Â &#125;</span><br><span class="line">Â Â <span class="keyword">let</span>Â <span class="title function_">myitem</span>Â =Â (<span class="params">text:Â string</span>)Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">let</span>Â itemÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">CompletionItem</span>(text,Â vscode.<span class="property">CompletionItemKind</span>.<span class="property">Function</span>);</span><br><span class="line">Â Â Â Â item.<span class="property">range</span>Â =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Range</span>(position,Â position);</span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â item;</span><br><span class="line">Â Â &#125;;</span><br><span class="line">Â Â <span class="keyword">return</span>Â _fnData.<span class="title function_">map</span>(<span class="function"><span class="params">_fnItem</span>Â =&gt;</span>Â <span class="title function_">myitem</span>(_fnItem.<span class="property">fnName</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·³è½¬åˆ°å®šä¹‰">è·³è½¬åˆ°å®šä¹‰</h3>
<p>æ€è·¯ï¼š</p>
<ul>
<li>è·å–tsæ–‡ä»¶ä¸­exportå‡ºæ¥çš„functionåˆ—è¡¨ï¼ŒåŒ…æ‹¬æ¯ä¸ªfunctionå¯¹åº”çš„locï¼ˆå³functionåœ¨ç¼–è¾‘å™¨ä¸­æ‰€å¤„çš„ä½ç½®ä¿¡æ¯ï¼‰ï¼Œ<strong>è¿™å°±æ˜¯å‰é¢æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å°†tsæ–‡ä»¶è½¬åŒ–ä¸ºASTçš„é‡è¦åŸå› </strong>ï¼Œåé¢å®ç°ä»£ç è·³è½¬éœ€è¦ç”¨åˆ°è¿™äº›ä½ç½®ä¿¡æ¯</li>
<li>è·å–å…‰æ ‡å¤„æ‰€åœ¨çš„functionå¹¶è·³è½¬åˆ°å¯¹åº”tsæ–‡ä»¶ä¸­çš„å¯¹åº”ä½ç½®</li>
</ul>
<p>å…³é”®ä»£ç å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>Â <span class="keyword">function</span>Â <span class="title function_">provideDefinition</span>(<span class="params"><span class="variable language_">document</span>:Â vscode.TextDocument,Â position:Â vscode.Position,Â token</span>)Â &#123;</span><br><span class="line">Â Â <span class="keyword">const</span>Â _filePathÂ =Â <span class="title function_">getFilePath</span>(<span class="variable language_">document</span>,Â filePath);</span><br><span class="line">Â Â <span class="keyword">const</span>Â _fnDataÂ =Â <span class="title function_">getFnFromTsFile</span>(<span class="string">`<span class="subst">$&#123;_filePath&#125;</span>.ts`</span>);Â Â </span><br><span class="line">Â Â <span class="keyword">const</span>Â _wordRangePositionÂ =Â <span class="variable language_">document</span>.<span class="title function_">getWordRangeAtPosition</span>(position);</span><br><span class="line">Â Â <span class="keyword">const</span>Â wordÂ =Â <span class="variable language_">document</span>.<span class="title function_">getText</span>(_wordRangePosition);Â <span class="comment">//Â è·å–å½“å‰å…‰æ ‡è¾“å…¥å­—ç¬¦</span></span><br><span class="line">Â Â <span class="keyword">const</span>Â _regÂ =Â <span class="keyword">new</span>Â <span class="title class_">RegExp</span>(<span class="string">`&quot;<span class="subst">$&#123;fileName&#125;</span>\..*&quot;`</span>);Â Â </span><br><span class="line">Â Â <span class="keyword">if</span>Â (_reg.<span class="title function_">test</span>(word))Â &#123;</span><br><span class="line">Â Â Â Â <span class="comment">//Â constÂ _fnNameÂ =Â word.replace(/&quot;index\.|&quot;/g,Â &#x27;&#x27;);</span></span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _fnNameÂ =Â word.<span class="title function_">replace</span>(<span class="keyword">new</span>Â <span class="title class_">RegExp</span>(<span class="string">`&quot;<span class="subst">$&#123;fileName&#125;</span>\.|&quot;`</span>,Â <span class="string">&#x27;g&#x27;</span>),Â <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">if</span>(_fnData.<span class="title function_">map</span>(<span class="function"><span class="params">_fnItem</span>Â =&gt;</span>Â _fnItem.<span class="property">fnName</span>).<span class="title function_">includes</span>(_fnName))Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">const</span>Â filePathÂ =Â <span class="string">`<span class="subst">$&#123;_filePath&#125;</span>.ts`</span>;</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">for</span>(<span class="keyword">const</span>Â _fnItemÂ <span class="keyword">of</span>Â _fnData)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(_fnItem.<span class="property">fnName</span>Â ===Â _fnName)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â tmpPathÂ =Â <span class="string">`file:///<span class="subst">$&#123;filePath&#125;</span>`</span>;Â <span class="comment">//Â <span class="doctag">TODO:</span>Â è¸©å‘è®°å½•Â å¿…é¡»Â ///</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>Â (fs.<span class="title function_">existsSync</span>(filePath))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _targetUriÂ =Â vscode.<span class="property">Uri</span>.<span class="title function_">parse</span>(tmpPath);Â <span class="comment">//Â <span class="doctag">TODO:</span>Â è¸©å‘è®°å½•Â ä½¿ç”¨parse</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _targetPositionÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Position</span>(_fnItem.<span class="property">loc</span>.<span class="property">start</span>.<span class="property">line</span>,Â _fnItem.<span class="property">loc</span>.<span class="property">start</span>.<span class="property">column</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _targetRangeÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Range</span>(_targetPosition,Â _targetPosition);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _fileNameLenÂ =Â (fileNameÂ <span class="keyword">as</span>Â string).<span class="property">length</span>Â ||Â <span class="number">0</span>;</span><br><span class="line">             <span class="comment">//Â å½“æŒ‰ä½ctrlæ—¶ï¼Œç¼–è¾‘å™¨é»˜è®¤ä¼šå°†è¿åœ¨ä¸€å—çš„å­—ç¬¦éƒ½æ˜¾ç¤ºå‡ºæ¥ä¸‹åˆ’çº¿Â è¿™æ—¶å€™å¦‚æœæƒ³æŒ‡å®šå“ªäº›å­—ç¬¦éœ€è¦æ˜¾ç¤ºä¸‹åˆ’çº¿éœ€è¦é…ç½®ä»¥ä¸‹çš„originSelectionRange</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _orgSelectionStartPositionÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Position</span>(_wordRangePosition.<span class="property">start</span>.<span class="property">line</span>,Â _wordRangePosition.<span class="property">start</span>.<span class="property">character</span>Â +Â _fileNameLenÂ +Â <span class="number">2</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _orgSelectionEndPositionÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Position</span>(_wordRangePosition.<span class="property">end</span>.<span class="property">line</span>,Â _wordRangePosition.<span class="property">end</span>.<span class="property">character</span>Â -Â <span class="number">1</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _originSelectionRangeÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Range</span>(_orgSelectionStartPosition,Â _orgSelectionEndPosition);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â <span class="attr">_locationLink</span>:Â vscode.<span class="property">LocationLink</span>Â =Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">originSelectionRange</span>:Â _originSelectionRange,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">targetUri</span>:Â _targetUri,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">targetRange</span>:Â _targetRange</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â &#125;;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â [_locationLink];</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="comment">//Â returnÂ newÂ vscode.Location(vscode.Uri.parse(tmpPath),Â newÂ vscode.Position(_fnItem.loc.start.line,Â _fnItem.loc.start.column));</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ™ºèƒ½è¯Šæ–­-æç¤º">æ™ºèƒ½è¯Šæ–­&amp;æç¤º</h3>
<p>è¿™ä¸ªåŠŸèƒ½çš„ä¸»è¦å¯¹è±¡æ˜¯jsonæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è·å–åˆ°jsonæ–‡ä»¶ä¸­æ‰€æœ‰çš„å­—æ®µï¼ŒåŒ…æ‹¬æ¯ä¸ªå­—æ®µæ‰€å¤„çš„ä½ç½®ä¿¡æ¯ï¼ˆä¸ºäº†åé¢æ˜¾ç¤ºæ³¢æµªçº¿ï¼‰ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°è¯´ï¼Œå°†jsonæ–‡ä»¶è½¬åŒ–ä¸ºASTï¼Œæ€è·¯æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å‰é¢è¯´çš„<code>@babel/traverse</code>åªèƒ½ç”¨æ¥è½¬åŒ–jsæˆ–tsæ–‡ä»¶ï¼Œå¹¶ä¸æ”¯æŒjsonæ–‡ä»¶çš„è½¬åŒ–</p>
<p>å¹¸å¥½åˆ«äººå·²ç»æœ‰å†™è¿‡ç±»ä¼¼çš„è½®å­äº†ï¼Œ<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/json-to-ast">json-to-ast</a>å‡ºåœºï¼Œ<code>json-to-ast</code>å¯ä»¥å°†jsonæ–‡ä»¶è½¬åŒ–ä¸ºASTï¼Œæ„Ÿè°¢å¼€æºã€‚</p>
<p>å¦å¤–ï¼šåœ¨VS Codeä¸­æ™ºèƒ½è¯Šæ–­ä½¿ç”¨<code>createDiagnosticCollection</code>è¿™ä¸ªAPIæ¥å®ç°çš„ï¼Œåˆ‡è®°ã€‚</p>
<p>å…³é”®ä»£ç å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â æ™ºèƒ½è¯Šæ–­Â æ³¢æµªçº¿æç¤º</span></span><br><span class="line"><span class="keyword">const</span>Â collectionÂ =Â vscode.<span class="property">languages</span>.<span class="title function_">createDiagnosticCollection</span>(<span class="string">&#x27;testFnName&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>Â (vscode.<span class="property">window</span>.<span class="property">activeTextEditor</span>)Â &#123;</span><br><span class="line">Â Â collection.<span class="title function_">clear</span>();</span><br><span class="line">Â Â <span class="title function_">updateDiagnostics</span>(vscode.<span class="property">window</span>.<span class="property">activeTextEditor</span>.<span class="property">document</span>,Â collection);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨onDidChangeTextDocumentç›‘å¬ç¼–è¾‘æ–‡æ¡£äº‹ä»¶</span></span><br><span class="line">context.<span class="property">subscriptions</span>.<span class="title function_">push</span>(vscode.<span class="property">workspace</span>.<span class="title function_">onDidChangeTextDocument</span>(<span class="function"><span class="params">editor</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â <span class="keyword">if</span>Â (editor)Â &#123;</span><br><span class="line">Â Â Â Â collection.<span class="title function_">clear</span>();</span><br><span class="line">Â Â Â Â <span class="title function_">updateDiagnostics</span>(editor.<span class="property">document</span>,Â collection);</span><br><span class="line">Â Â &#125;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>Â <span class="keyword">function</span>Â <span class="title function_">updateDiagnostics</span>(<span class="params"><span class="variable language_">document</span>:Â vscode.TextDocument,Â collection:Â vscode.DiagnosticCollection</span>):Â <span class="keyword">void</span>Â &#123;</span><br><span class="line">Â Â <span class="keyword">const</span>Â _textÂ =Â <span class="variable language_">document</span>.<span class="title function_">getText</span>();</span><br><span class="line">Â Â <span class="keyword">const</span>Â _jsonAstÂ =Â <span class="title function_">jsonToAst</span>(_text)Â <span class="keyword">as</span>Â jsonToAst.<span class="property">ObjectNode</span>;</span><br><span class="line">Â Â <span class="keyword">const</span>Â <span class="attr">_errorText</span>:Â <span class="title class_">JsonTextInfo</span>[]Â =Â [];</span><br><span class="line">Â Â <span class="keyword">const</span>Â _filePathÂ =Â <span class="title function_">getFilePath</span>(<span class="variable language_">document</span>,Â filePath);</span><br><span class="line">Â Â <span class="keyword">const</span>Â _fnDataÂ =Â <span class="title function_">getFnFromTsFile</span>(<span class="string">`<span class="subst">$&#123;_filePath&#125;</span>.ts`</span>);Â Â </span><br><span class="line">Â Â <span class="keyword">const</span>Â <span class="title function_">recursiveJsonAst</span>Â =Â (<span class="params">astArr:Â any[]</span>)Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â astArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">jsonAstItem</span>)Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">const</span>Â _valueÂ =Â jsonAstItem?.<span class="property">value</span>Â ||Â jsonAstItem?.<span class="property">children</span>;</span><br><span class="line">Â Â Â Â Â Â <span class="keyword">if</span>(_value.<span class="property">children</span>)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="title function_">recursiveJsonAst</span>(_value.<span class="property">children</span>);</span><br><span class="line">Â Â Â Â Â Â &#125;Â <span class="keyword">else</span>Â <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(_value))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="title function_">recursiveJsonAst</span>(_value);</span><br><span class="line">Â Â Â Â Â Â &#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _textValueÂ =Â _value.<span class="property">value</span>;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _regÂ =Â <span class="keyword">new</span>Â <span class="title class_">RegExp</span>(<span class="string">`<span class="subst">$&#123;fileName&#125;</span>\..*`</span>,Â <span class="string">&#x27;g&#x27;</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">if</span>(_reg.<span class="title function_">test</span>(_textValue))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">const</span>Â _fnValÂ =Â _textValue.<span class="title function_">replace</span>(<span class="keyword">new</span>Â <span class="title class_">RegExp</span>(<span class="string">`<span class="subst">$&#123;fileName&#125;</span>\.`</span>,Â <span class="string">&#x27;g&#x27;</span>),Â <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>(!_fnData.<span class="title function_">map</span>((<span class="function"><span class="params">_fnItem</span>Â =&gt;</span>Â _fnItem.<span class="property">fnName</span>)).<span class="title function_">includes</span>(_fnVal))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â _errorText.<span class="title function_">push</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">value</span>:Â _fnVal,</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="attr">loc</span>:Â _value.<span class="property">loc</span></span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â &#125;);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â &#125;Â Â </span><br><span class="line">Â Â Â Â &#125;);</span><br><span class="line">Â Â &#125;;</span><br><span class="line">Â Â <span class="title function_">recursiveJsonAst</span>(_jsonAst.<span class="property">children</span>);</span><br><span class="line">Â Â <span class="keyword">const</span>Â _diagCollectionÂ =Â [];</span><br><span class="line">Â Â _errorText.<span class="title function_">forEach</span>(<span class="function"><span class="params">_errTextItem</span>Â =&gt;</span>Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _startÂ =Â _errTextItem.<span class="property">loc</span>.<span class="property">start</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _endÂ =Â _errTextItem.<span class="property">loc</span>.<span class="property">end</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _fileNameLenÂ =Â (fileNameÂ <span class="keyword">as</span>Â string).<span class="property">length</span>Â ||Â <span class="number">0</span>;</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _startPositionÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Position</span>(_start.<span class="property">line</span>Â -Â <span class="number">1</span>,Â _start.<span class="property">column</span>Â +Â _fileNameLenÂ +Â <span class="number">1</span>);</span><br><span class="line">Â Â Â Â <span class="keyword">const</span>Â _endPositionÂ =Â <span class="keyword">new</span>Â vscode.<span class="title class_">Position</span>(_end.<span class="property">line</span>Â -Â <span class="number">1</span>,Â _end.<span class="property">column</span>Â -Â <span class="number">2</span>);</span><br><span class="line">Â Â Â Â _diagCollection.<span class="title function_">push</span>(&#123;</span><br><span class="line">Â Â Â Â Â Â <span class="attr">message</span>:Â <span class="string">`FunctionÂ <span class="subst">$&#123;_errTextItem.value&#125;</span>Â doesÂ notÂ exist`</span>,</span><br><span class="line">Â Â Â Â Â Â <span class="attr">range</span>:Â <span class="keyword">new</span>Â vscode.<span class="title class_">Range</span>(_startPosition,Â _endPosition),</span><br><span class="line">Â Â Â Â Â Â <span class="attr">severity</span>:Â vscode.<span class="property">DiagnosticSeverity</span>.<span class="property">Error</span>,</span><br><span class="line">Â Â Â Â &#125;);</span><br><span class="line">Â Â &#125;);</span><br><span class="line">Â Â collection.<span class="title function_">set</span>(<span class="variable language_">document</span>.<span class="property">uri</span>,Â _diagCollection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸€äº›è¸©å‘">ä¸€äº›è¸©å‘</h2>
<ol>
<li>å‘å¸ƒæ’ä»¶æ—¶æ‰§è¡Œ<code>vsce publish</code>æ—¶æŠ¥é”™<code>ERROR Failed request: (401)</code>ï¼Œç”Ÿæˆçš„personal access tokenæƒé™å¼„é”™äº†ï¼Œåº”è¯¥é€‰<code>Full access</code></li>
</ol>
<p><img src="http://122.51.184.238/storage/files/1_5_%E6%9D%82%E7%83%A9/2_25_json-go-ts1.jpeg" alt></p>
<ol start="2">
<li>
<p>å‘å¸ƒæ’ä»¶æ—¶æŠ¥é”™ï¼š<code>ERROR Make sure to edit the README.md file before you package or publish your extension</code> â€“ ä¿®æ”¹ä¸€ä¸‹å·¥ç¨‹é‡Œé¢çš„<code>README.md</code>æ–‡ä»¶ï¼ˆåŸæ¥çš„æ–‡ä»¶åˆ é™¤&amp;é‡å†™ï¼‰</p>
</li>
<li>
<p>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/manage/createpublisher?managePageRedirect=true">åœ°å€</a>åˆ›å»ºpublisherè´¦å·ä¸€ç›´ä¸æˆåŠŸ â€“ ç½‘ç»œè¢«é™åˆ¶äº†ï¼ˆç§‘å­¦ä¸Šç½‘çœŸé¦™ï¼‰</p>
</li>
<li>
<p>æ’ä»¶åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹å¯ä»¥è¿è¡Œï¼Œå‘å¸ƒåˆ°çº¿ä¸Šæ²¡æœ‰å“åº”ï¼ˆä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼‰</p>
<p>ç»è¿‡æ’æŸ¥ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨äº†ä¸€äº›npmåº“ï¼Œä½†æ˜¯å‘å¸ƒæ’ä»¶æ—¶ä½¿ç”¨äº†<code>tsc</code>æ¥ç¼–è¯‘ï¼Œè¿™ç§æƒ…å†µä¸‹<code>node_modules</code>é‡Œé¢ä¸€äº›npmåº“çš„ä»£ç æ˜¯æ²¡æœ‰è¢«ç¼–è¯‘è¿›å»çš„ã€‚éœ€è¦å¼•å…¥<code>webpack</code>æ¥è¿›è¡Œæ‰“åŒ…&amp;ç¼–è¯‘</p>
</li>
</ol>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/64584850/get-vscode-registercompletionitemprovider-to-work-in-a-json-file-with-a-word">jsonæ–‡ä»¶ä¸­è‡ªåŠ¨è¡¥å…¨é¢æ¿ä¸å¼¹å‡º</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liuxianan/p/vscode-plugin-overview.html">VS Codeæ’ä»¶å¼€å‘å…¨æ”»ç•¥</a></li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension">VS Code Document</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Microsoft/vscode-extension-samples/">Some demo</a></li>
</ul>

      </div>
        <div class="support-author">
          <p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚ ğŸ™
          <a href="https://888.com/index.html" target="_blank">å…³äºè½¬è½½è¯·çœ‹è¿™é‡Œ</a>
            <!--<a class="btn-pay"  href="#pay-modal">Â¥ æ‰“èµæ”¯æŒ</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>å–œæ¬¢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '4008c278909d8497d8ad',
    clientSecret: 'e27df4736052523348bbf856ba03e1d350143b93',
    repo: 'YonSunZhen.github.io',
    owner: 'YonSunZhen',
    admin: ['YonSunZhen'],
    id: md5(location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>

        </div>
      </div>
    </div>
   </div>
</main>
<div class="footer">
  <div class="info">
    <p>
    <a target="_blank" rel="noopener" href="https://hexo.io"> Hexo </a> å¼ºåŠ›é©±åŠ¨|
      <a target="_blank" rel="noopener" href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      ä¸»é¢˜
    </p>
    <p>
      &copy;
      <a href="http://beian.miit.gov.cn" target="_blank">YonSunZhençš„ä¸ªäººåšå®¢ ç²¤ICPå¤‡18135123å·Â </a> 
    </p>  
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="/./js/canvas-nest.js"></script> -->

<script type="text/javascript" src="/./js/main.4a9772.js"></script>
<script type="text/javascript" src="/./js/jquery-1.6.2.min.js"></script>
<!-- if CDN fails, use local file -->
<script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
<script> window.mermaid || document.write('<script src="/./js/mermaid.min.js"><\/script>')</script>
<script>mermaid.initialize({ startOnLoad: true });</script>

<!-- 
<script src="/assets/js/mermaid.min.js"></script>
 -->
<script>
  $(document).ready(function () {
    var mermaid_config = {
      startOnLoad: true,
      theme: 'dark',
      flowchart: {
        useMaxWidth: false,
        htmlLabels: true
      }
    }
    mermaid.initialize(mermaid_config);
  });
</script>


</body>
</html>
